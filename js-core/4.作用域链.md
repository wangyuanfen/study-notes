## 作用域链(Scope Chains)

作用域链是一个对象列表(list of objects)，用以检索上下文代码中出现的标识符(identifiers)，由多个执行上下文的变量对象构成的链表。  


## 函数的生命周期

函数的的生命周期分为创建和激活阶段（调用时）

## 函数创建

函数上下文的作用域链在函数调用时创建的，包含活动对象和这个函数内部的[[scope]]属性。  

函数的作用域在函数定义的时候就决定了，这是因为函数有一个内部属性 [[scope]]，[[scope]]是所有父变量对象的层级链，
处于当前函数上下文之上，在函数创建时存于其中。  
**[[scope]]在函数创建时被存储，静态（不变的），永远永远，直至函数销毁。即：
函数可以永不调用，但[[scope]]属性已经写入，并存储在函数对象中。**

函数创建时，各自的[[scope]]为：

    function foo() {
        function bar() {
            ...
        }
    }
    
    foo.[[scope]] = [
      globalContext.VO
    ];
    
    bar.[[scope]] = [
        fooContext.AO,
        globalContext.VO
    ];

## 函数激活

当函数激活时，进入函数上下文，创建 VO/AO 后，就会将活动对象添加到作用链的前端。

这时候执行上下文的作用域链，我们命名为 Scope：

    Scope = [AO].concat([[Scope]]);
    
## 流程总结

函数执行上下文中作用域链和变量对象的创建过程

    var x = 10;
     
    function foo() {
      var y = 20;
     
      function bar() {
        var z = 30;
        alert(x +  y + z);
      }
     
      bar();
    }
     
    foo(); // 60

对此，我们有如下的变量/活动对象，函数的的[[scope]]属性以及上下文的作用域链：

全局上下文的变量对象是：

    globalContext.VO === Global = {
      x: 10
      foo: <reference to function>
    };
    
在“foo”创建时，“foo”的[[scope]]属性是：

    foo.[[Scope]] = [
      globalContext.VO
    ];
    
在“foo”激活时（进入上下文），“foo”上下文的活动对象是：

    fooContext.AO = {
      y: 20,
      bar: <reference to function>
    };
    
    “foo”上下文的作用域链为：
    
    fooContext.Scope = fooContext.AO + foo.[[Scope]] // i.e.:
     
    fooContext.Scope = [
      fooContext.AO,
      globalContext.VO
    ];
    
内部函数“bar”创建时，其[[scope]]为：

    bar.[[Scope]] = [
      fooContext.AO,
      globalContext.VO
    ];
    
在“bar”激活时，“bar”上下文的活动对象为：

    barContext.AO = {
      z: 30
    };
    
“bar”上下文的作用域链为：

    barContext.Scope = barContext.AO + bar.[[Scope]] // i.e.:
     
    barContext.Scope = [
      barContext.AO,
      fooContext.AO,
      globalContext.VO
    ];
    
对“x”、“y”、“z”的标识符解析如下：

    - "x"
    -- barContext.AO // not found
    -- fooContext.AO // not found
    -- globalContext.VO // found - 10
    
    - "y"
    -- barContext.AO // not found
    -- fooContext.AO // found - 20
    
    - "z"
    -- barContext.AO // found - 30
