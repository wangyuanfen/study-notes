## 变量对象(variable object)

变量对象(variable object) 是与执行上下文相关的 数据作用域(scope of data) 。 

变量对象(缩写为VO)是一个与执行上下文相关的特殊对象，它存储着在上下文中声明的以下内容：

    变量 (var, 变量声明);
    函数声明 (FunctionDeclaration, 缩写为FD);
    函数的形参  
    
变量对象（Variable Object）是一个抽象的概念，不同的上下文中，它表示使用不同的object。  

例如，在global全局上下文中，变量对象也是全局对象自身[global object]。
（这就是我们可以通过全局对象的属性来指向全局变量）。  

在一个函数上下文中，变量对象被表示为**活动对象(activation object)**缩写为**AO**。

## 活动对象(activation object)

当函数被调用者激活，这个特殊的活动对象(activation object) 就被创建了。它包含普通参数(formal parameters) 
与特殊参数(arguments)对象(具有索引属性的参数映射表)。活动对象在函数上下文中作为变量对象使用。  

即：函数的变量对象保持不变，但除去存储变量与函数声明之外，还包含以及特殊对象arguments 。

## 全局上下文中的变量对象

全局对象(Global object) 是在进入任何执行上下文之前就已经创建了的对象；
这个对象只存在一份，它的属性在程序中任何地方都可以访问，全局对象的生命周期终止于程序退出那一刻。

全局上下文中的变量对象就是全局对象自己

    VO(globalContext) === global;

## 函数上下文中的变量对象

在函数执行上下文中，VO是不能直接访问的，此时由活动对象(activation object,缩写为AO)扮演VO的角色。

活动对象和变量对象其实是一个东西，只是变量对象是规范上的或者说是引擎实现上的，不可在 JavaScript 环境中访问，  
只有到当进入一个执行上下文中，这个执行上下文的变量对象才会被激活，所以才叫 activation object，而只有被激活的  
变量对象，也就是活动对象上的各种属性才能被访问。

## 处理上下文代码的2个阶段

执行上下文的代码会分成两个阶段进行处理：分析和执行，我们也可以叫做：

+  进入执行上下文
+  代码执行

## 进入执行上下文
当进入执行上下文(代码执行之前)时，VO里已经包含了下列属性(前面已经说了)：

1.函数的所有形参(如果我们是在函数执行上下文中)  

+ 由名称和对应值组成的一个变量对象的属性被创建；  
+ 没有传递对应参数的话，那么由名称和undefined值组成的一种变量对象的属性也将被创建。

2.所有函数声明(FunctionDeclaration, FD)

+ 由名称和对应值（函数对象(function-object)）组成一个变量对象的属性被创建；
+ 如果变量对象已经存在相同名称的属性，则完全替换这个属性。

3.所有变量声明(var, VariableDeclaration)

+ 由名称和对应值（undefined）组成一个变量对象的属性被创建；
+ 如果变量名称跟已经声明的形式参数或函数相同，则变量声明不会干扰已经存在的这类属性。

举个例子：

    function foo(a) {
      var b = 2;
      function c() {}
      var d = function() {};
    
      b = 3;
    
    }

    foo(1);
    
在进入执行上下文后，这时候的 AO 是：

    AO = {
        arguments: {
            0: 1,
            length: 1
        },
        a: 1,
        b: undefined,
        c: reference to function c(){},
        d: undefined
    }

## 代码执行

这个周期内，AO/VO已经拥有了属性(不过，并不是所有的属性都有值，大部分属性的值还是系统默认的初始值undefined )。

    AO = {
        arguments: {
            0: 1,
            length: 1
        },
        a: 1,
        b: 3,
        c: reference to function c(){},
        d: reference to FunctionExpression "d"
    }
    
到这里变量对象的创建过程就介绍完了，让我们简洁的总结我们上述所说：

1. 全局上下文的变量对象初始化是全局对象

2. 函数上下文的变量对象初始化只包括 Arguments 对象

3. 在进入执行上下文时会给变量对象添加形参、函数声明、变量声明等初始的属性值

4. 在代码执行阶段，会再次修改变量对象的属性值

## 关于变量

**任何时候，变量只能通过使用var关键字才能声明。**

    alert(a); // undefined
    alert(b); // "b" 没有声明
     
    b = 10;
    var a = 20;

所有根源仍然是VO和进入上下文阶段和代码执行阶段：

进入上下文阶段：

    VO = {
      a: undefined
    };
因为“b”不是一个变量，所以在这个阶段根本就没有“b”，“b”将只在代码执行阶段才会出现
